<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Main Form</title>
    <link rel="stylesheet" href="/stylesheets/dashboard.css">
</head>

<body>
    <header>
        <div id="nav">
            <button id="myButton" onclick="handleMy()">마이</button>
            <button id="messageButton" onclick="handleMessage()">쪽지</button>
            <button id="logoutButton" onclick="handleLogout()">로그아웃</button>
        </div>
    </header>

    <div class="main-container">
        <div class="upperside">
            <div class="board">
                <div class="title-bar">
                    <h3>게시판</h3>
                    <a href="/boards">더보기</a>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>제목</th>
                            <th>유저 ID</th>
                            <th>날짜</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% boardPosts.forEach(board=> { %>
                            <tr>
                                <td>
                                    <%= board.title %>
                                </td>
                                <td>
                                    <%= board.writer_id %>
                                </td>
                                <td>
                                    <%= board.created_at %>
                                </td>
                            </tr>
                            <% }) %>
                    </tbody>
                </table>
            </div>

            <div class="popular-product">
                <h3>조회수 높은 상품</h3>
                
                <% popularProducts.forEach(product=> { %>
                    <div class="product">
                        <p>카테고리: <%= product.category_name %>
                        </p>
                        <p>상품명: <%= product.product_name %>
                        </p>
                        <p>조회수: <%= product.view_count %>
                        </p>
                    </div>
                    <% }) %>
            </div>
        </div>

        <div class="downside">
            <div class="recent-products">
                <div class="title-bar">
                    <h3>최근 등록된 상품</h3>
                    <a href="/products">더보기</a>
                </div>

                <% recentProducts.forEach(product=> { %>
                    <div class="product">
                        <p>상품명: <%= product.product_name %>
                        </p>
                        <p>등록일: <%= product.created_at %>
                        </p>
                    </div>
                    <% }) %>
            </div>

            <div class="recent-transactions">
                <div class="title-bar">
                    <h3>최근 거래된 상품</h3>
                    <a href="/products">더보기</a>
                </div>

                <% recentTransactions.forEach(transaction=> { %>
                    <div class="product">
                        <p>상품명: <%= transaction.product_name %>
                        </p>
                        <p>거래일: <%= transaction.transaction_at %>
                        </p>
                    </div>
                    <% }) %>
            </div>
        </div>
    </div>

    <script>
        function handleMy() {
            window.location.href = '/mypage';

            // fetch('/auth/check-login') // 로그인 상태 확인 API
            //     .then(res => res.json())
            //     .then(data => {
            //         if (data.isLoggedIn) {
            //             window.location.href = '/mypage'; // 마이 페이지로 이동
            //         } else {
            //             window.location.href = '/login'; // 로그인 페이지로 이동
            //         }
            //     })
            //     .catch(err => console.error(err));
        }

        function handleMessage() {
            window.location.href = '/message'; // 쪽지 페이지로 이동
        }

        function handleLogout() {
            window.location.href = '/logout'; // 로그아웃 요청
        }
    </script>
</body>

</html>